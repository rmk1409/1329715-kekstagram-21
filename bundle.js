(()=>{"use strict";(()=>{const e=document.querySelector(".error-popup"),t=e.querySelector(".error-popup--msg"),n=e.querySelector(".error-popup--button"),o=document.querySelector("main"),r=document.querySelector("#error");let c,i;const s=document.querySelector("#success");let d,a;function l(){e.classList.add("error-popup--hidden"),n.removeEventListener("click",l)}function u(){o.removeChild(o.querySelector(".error")),i.removeEventListener("click",m),document.removeEventListener("click",p),document.removeEventListener("click",v)}function m(){u()}function p(e){e.preventDefault(),"Escape"===e.key&&u()}function v(e){e.target.matches(".error")&&u()}function f(e){e.preventDefault(),"Escape"===e.key&&L()}function y(e){e.target.matches(".success")&&L()}function L(){o.removeChild(o.querySelector(".success")),a.removeEventListener("click",h),document.removeEventListener("keydown",f),document.removeEventListener("click",y)}function h(){L()}window.popupMsg={onLoadError:function(o){t.textContent=o,e.classList.remove("error-popup--hidden"),n.addEventListener("click",l)},onSendError:function(){c=r.content.cloneNode(!0),i=c.querySelector(".error__button"),o.appendChild(c),i.addEventListener("click",m),document.addEventListener("keydown",p),document.addEventListener("click",v)},onSendSuccess:function(){d=s.content.cloneNode(!0),a=d.querySelector(".success__button"),o.appendChild(d),a.addEventListener("click",h),window.addEventListener("keydown",f),document.addEventListener("click",y)}}})(),(()=>{function e(e,t,n,o,r){const c=new XMLHttpRequest;"GET"===e&&(c.responseType="json"),c.addEventListener("error",(()=>n("There is connection error"))),c.addEventListener("timeout",(()=>n("There is timeout error, passed more than 5 sec."))),c.timeout=5e3,c.addEventListener("load",(()=>function(e,t,n){const o=e.status;switch(o){case 200:t(e.response);break;default:n(`There is an error, status code is - ${o}.`)}}(c,t,n))),c.open(e,o),r?c.send(r):c.send()}window.backend={load:function(t,n){e("GET",t,n,"https://21.javascript.pages.academy/kekstagram/data")},send:function(t,n,o){e("POST",t,n,"https://javascript.pages.academy/kekstagram",o)}}})(),(()=>{const e="img-filters__button--active",t=document.querySelector("#picture").content.querySelector("a.picture"),n=document.querySelector(".pictures"),o=document.querySelector(".img-filters"),r={"filter-default":(e,t)=>e.id-t.id,"filter-random":()=>Math.random()-.5,"filter-discussed":(e,t)=>t.comments.length-e.comments.length};let c,i=[];function s(e,n){const o=t.cloneNode(!0);return o.dataset.id=e.id,o.dataset.orderNumber=n,o.querySelector(".picture__img").src=e.url,o.querySelector(".picture__likes").textContent=e.likes,o.querySelector(".picture__comments").textContent=e.comments.length.toString(),o}function d(e,t){const o=document.createDocumentFragment();e&&i.sort(e);const r=t||i.length;for(let e=0;e<r;e++){let t=i[e];o.appendChild(s(t,e+1))}n.querySelectorAll(".picture").forEach((e=>e.remove())),n.appendChild(o)}o.addEventListener("click",(function(t){c&&window.clearTimeout(c);let n=t.target;!n.matches("."+e)&&n.matches("button")&&(t.preventDefault(),o.querySelector("."+e).classList.toggle(e,!1),n.classList.toggle(e,!0),c=setTimeout((function(){const e="filter-random"===n.id?10:void 0;d(r[n.id],e)}),500))})),window.picture={data:i,section:n,fill:function(e){i.length=0;for(let t=0;t<e.length;t++)e[t].id=t+1;i.push(...e),o.classList.toggle("img-filters--inactive",!1),d(),window.addListenersToPreview()}}})(),(()=>{const e=document.querySelector(".big-picture"),t=e.querySelector(".big-picture__img img"),n=e.querySelector(".likes-count"),o=e.querySelector(".comments-count"),r=e.querySelector(".comments-current-count"),c=e.querySelector(".social__comments"),i=e.querySelector(".social__caption"),s=e.querySelector(".social__comment-count"),d=e.querySelector(".comments-loader"),a=e.querySelector(".big-picture__cancel");function l(e){const t=document.createDocumentFragment(),n=e.target.closest(".big-picture").dataset.orderNumber,o=window.picture.data[n-1],i=o.comments.length;let a=parseInt(r.textContent,10),l=i;for(i>a+5?(s.classList.remove("hidden"),d.classList.remove("hidden"),l=a+5,r.textContent=l.toString()):(s.classList.add("hidden"),d.classList.add("hidden"));a<l;a++){const e=o.comments[a];t.appendChild(f(e))}c.appendChild(t)}function u(u,m){document.body.classList.add("modal-open"),e.classList.remove("hidden"),e.dataset.orderNumber=m,t.src=u.url,n.textContent=u.likes,i.textContent=u.description,c.innerHTML="",function(e){const t=document.createDocumentFragment(),n=e.comments.length;let i=5;n<=5?(s.classList.add("hidden"),d.classList.add("hidden"),i=n):(s.classList.remove("hidden"),d.classList.remove("hidden"),r.textContent=i.toString(),o.textContent=n.toString());for(let n=0;n<i;n++){const o=e.comments[n];t.appendChild(f(o))}c.appendChild(t)}(u),a.addEventListener("click",p),document.addEventListener("keydown",v),d.addEventListener("click",l)}function m(){e.classList.add("hidden"),document.body.classList.remove("modal-open"),a.removeEventListener("click",p),document.removeEventListener("keydown",v),d.removeEventListener("click",l)}function p(){m()}function v(e){"Escape"===e.key&&(e.preventDefault(),m())}function f(e){const t=document.createElement("li"),n=document.createElement("img"),o=document.createElement("p");return t.classList.add("social__comment"),n.classList.add("social__picture"),n.src=e.avatar,n.alt=e.name,n.width=35,n.height=35,o.classList.add("social__text"),o.textContent=e.message,t.appendChild(n),t.appendChild(o),t}function y(e){const t=e.target.closest(".picture");t&&(e.preventDefault(),u(window.picture.data[t.dataset.orderNumber-1],t.dataset.orderNumber))}function L(e){const t=e.target;"Enter"===e.key&&t.matches(".picture")&&u(window.picture.data[t.dataset.orderNumber-1],t.dataset.orderNumber)}window.addListenersToPreview=function(){window.picture.section.addEventListener("click",y),window.picture.section.addEventListener("keydown",L)}})(),window.checkHashTags=function(e){const t=e.split(" ").filter((e=>e.trim())),n=function(e){return e.every((e=>e.startsWith("#")))}(t)&&function(e){const t=RegExp("^#(\\w){1,19}$");return e.every((e=>t.test(e)))}(t)&&function(e){return e.length===new Set(e.map((e=>e.toUpperCase()))).size}(t)&&function(e){return e.length<=5}(t);return!e||n},(()=>{const e=document.querySelector("#upload-select-image"),t=e.querySelector("#upload-file"),n=e.querySelector("#upload-cancel"),o=e.querySelector(".img-upload__overlay"),r=e.querySelector(".img-upload__scale"),c=r.querySelector(".scale__control--value"),i=e.querySelector(".img-upload__preview img"),s=e.querySelector(".effects"),d=e.querySelector(".img-upload__effect-level"),a=e.querySelector(".effect-level__pin"),l=e.querySelector(".effect-level__value"),u=e.querySelector(".effect-level__depth"),m=e.querySelector(".effect-level__line"),p=e.querySelector("#effect-none"),v=e.querySelector(".text__hashtags"),f=e.querySelector(".text__description");let y=!1;function L(){document.body.classList.remove("modal-open"),o.classList.add("hidden"),e.reset(),window.removeEventListener("keydown",w),n.removeEventListener("click",E),r.removeEventListener("click",_),s.removeEventListener("change",C),a.removeEventListener("mousedown",x),m.removeEventListener("click",b),v.setCustomValidity(""),v.removeEventListener("input",N),e.removeEventListener("submit",M)}function h(){i.className="",i.style.filter="",p.checked=!0,d.style.display="none"}function g(){document.body.classList.add("modal-open"),o.classList.remove("hidden"),h(),S(100),window.addEventListener("keydown",w),n.addEventListener("click",E),r.addEventListener("click",_),s.addEventListener("change",C),a.addEventListener("mousedown",x),m.addEventListener("click",b),v.addEventListener("input",N),e.addEventListener("submit",M)}function w(e){const t=document.activeElement;"Escape"===e.key&&t!==v&&t!==f&&(e.preventDefault(),L())}function E(){L()}function S(e=100){c.value=e+"%",i.style.transform=`scale(${e/100})`}function _(e){const t=e.target;if("BUTTON"===t.tagName){const e=parseInt(c.value,10);let n;t.matches(".scale__control--smaller")?(n=e-25,n=n<25?25:n):t.matches(".scale__control--bigger")&&(n=e+25,n=n>100?100:n),S(n)}}function k(e=100){e=Math.round(e),l.value=""+e,a.style.left=e+"%",u.style.width=e+"%"}function q(){const e=l.value,t=i.className.split("--")[1];i.style.filter=D[t](e)}function b(e){y||(e.preventDefault(),a.style.transitionDuration="0.3s",u.style.transitionDuration="0.3s",k(T(e.offsetX)),setTimeout((function(){a.style.transitionDuration="",u.style.transitionDuration=""}),300),q()),y=!1}function C(e){const t=e.target.value;S(100),"none"===t?h():(i.style.filter="",i.className="effects__preview--"+t,d.style.display="block",k(100))}const D={chrome:e=>`grayscale(${e/100})`,sepia:e=>`sepia(${e/100})`,marvin:e=>`invert(${e}%)`,phobos:e=>`blur(${e/33}px)`,heat:e=>`brightness(${1+e/50})`};function T(e){return e/m.offsetWidth*100}function x(e){function t(e){e.preventDefault(),y=!0;const t=T(e.movementX),n=l.value;let o=parseInt(n,10)+t;(o>100||o<0)&&(o=o>100?100:0),k(o),q()}e.preventDefault(),document.addEventListener("mousemove",t),document.addEventListener("mouseup",(function e(n){n.preventDefault(),document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",e)}))}function N(){const e=v.value.trim();window.checkHashTags(e)?v.setCustomValidity(""):v.setCustomValidity("Something wrong in tags!")}function M(t){let n=new FormData(e);L(),window.backend.send(window.popupMsg.onSendSuccess,window.popupMsg.onSendError,n),t.preventDefault()}window.addListenersToForm=function(){t.addEventListener("change",g)}})(),window.backend.load(window.picture.fill,window.popupMsg.onLoadError),window.addListenersToForm()})();